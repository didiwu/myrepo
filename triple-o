Create stack user
# useradd stack
# passwd stack
# echo "stack ALL=(root) NOPASSWD:ALL" > /etc/sudoers.d/stack
# chmod 0440 /etc/sudoers.d/stack

Update hosts file
# echo "172.16.0.10 undercloud.localdomain undercloud" >> /etc/hosts

Install the tripleoclient
# yum install -y http://rdoproject.org/repos/openstack-liberty/rdo-release-newton.rpm
# yum install -y python-tripleoclient

Install undercloud
# su - stack
$ vi undercloud.conf
$ openstack undercloud install

Get and upload images
$ . stackrc
$ export NODE_DIST=centos7
$ export USE_DELOREAN_TRUNK=1
$ export DELOREAN_TRUNK_REPO="http://buildlogs.centos.org/centos/7/cloud/x86_64/rdo-trunk-master-tripleo/"
$ export DELOREAN_REPO_FILE="delorean.repo"
$ mkdir images
$ cd images
$ openstack overcloud image build --all
$ openstack overcloud image upload

Enable fake_pxe driver on ironic
$ sudo vi /etc/ironic/ironic.conf
enabled_drivers = pxe_ipmitool,pxe_ssh,pxe_drac,pxe_ilo,pxe_wol,pxe_amt,fake_px
$ sudo systemctl restart openstack-ironic-conductor.service

Register overcloud nodes
$ vi instackenv.json
$ openstack baremetal import --json instackenv.json
$ openstack baremetal configure boot
$ openstack baremetal introspection bulk start
Bounce each overcloud node to start the instrospection process.



openstack overcloud deploy --templates /usr/share/openstack-tripleo-heat-templates --control-scale 1 --compute-scale 2 --ceph-storage-scale 2 --neutron-tunnel-types vxlan --neutron-network-type vxlan --control-flavor control --compute-flavor compute --ceph-storage-flavor ceph-storage -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml -e ~/templates/network-environment.yaml -e ~/templates/storage-environment.yaml -e ~/templates/firstboot/firstboot.yaml
